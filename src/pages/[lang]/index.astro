---
import Base from '@/layouts/Base.astro';
import CTA from '@/components/CTA.astro';
import TopicCard from '@/components/TopicCard.astro';
import { siteConfig, type Locale } from '@/config/site';
import { t } from '@/i18n/ui';
import { languageToRegions } from '@/i18n/languages';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  return siteConfig.locales.map((lang) => ({
    params: { lang },
  }));
}

const { lang } = Astro.params as { lang: Locale };

const regions = languageToRegions[lang] || ['global'];
const allTopics = await getCollection('topics');

const topics = allTopics
  .filter(topic => regions.includes(topic.data.region) && topic.data.locale[lang])
  .sort((a, b) => new Date(b.data.publishedAt).getTime() - new Date(a.data.publishedAt).getTime())
  .slice(0, 12);
---

<Base title={t('nav.home', lang)} lang={lang}>
  <!-- Hero Section -->
  <section class="relative min-h-[80vh] flex items-center overflow-hidden">
    <!-- Background Grid -->
    <div class="absolute inset-0 opacity-10">
      <div class="absolute inset-0" style="background-image: linear-gradient(var(--color-border) 1px, transparent 1px), linear-gradient(90deg, var(--color-border) 1px, transparent 1px); background-size: 60px 60px;"></div>
    </div>
    
    <!-- Accent Glow -->
    <div class="absolute top-1/4 -right-1/4 w-[600px] h-[600px] rounded-full bg-[var(--color-accent)] opacity-10 blur-[120px]"></div>
    
    <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20">
      <div class="max-w-3xl space-y-8">
        <!-- Eyebrow -->
        <div class="animate-fade-in-up stagger-1">
          <span class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-[var(--color-surface-elevated)] border border-[var(--color-border)] text-sm font-mono text-[var(--color-accent)]">
            <span class="w-2 h-2 rounded-full bg-[var(--color-accent)] animate-pulse"></span>
            Minority Game
          </span>
        </div>
        
        <!-- Headline -->
        <h1 class="text-5xl sm:text-6xl lg:text-7xl font-bold tracking-tight animate-fade-in-up stagger-2">
          <span class="block">Predict the</span>
          <span class="block text-gradient">Unpredictable</span>
        </h1>
        
        <!-- Subheadline -->
        <p class="text-xl sm:text-2xl text-[var(--color-paper)] opacity-70 max-w-xl animate-fade-in-up stagger-3">
          Join the minority to win. Make predictions on real-world events and outsmart the crowd.
        </p>
        
        <!-- CTA Buttons -->
        <div class="flex flex-wrap items-center gap-4 animate-fade-in-up stagger-4">
          <CTA href={siteConfig.appUrl} size="lg" external>
            {t('cta.play', lang)}
          </CTA>
          <CTA href={`/${lang}/topics/`} variant="secondary" size="lg">
            {t('cta.viewAll', lang)}
          </CTA>
        </div>
      </div>
    </div>
  </section>

  <!-- Featured Topics -->
  {topics.length > 0 && (
    <section class="py-24 relative">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between mb-12">
          <h2 class="text-3xl sm:text-4xl font-bold">
            {t('topics.title', lang)}
          </h2>
          <CTA href={`/${lang}/topics/`} variant="ghost" size="sm">
            {t('cta.viewAll', lang)}
          </CTA>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {topics.map((topic) => (
            <TopicCard topic={topic.data} locale={lang} />
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- CTA Section -->
  <section class="py-24 relative">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <div class="p-12 rounded-2xl bg-gradient-to-br from-[var(--color-surface)] to-[var(--color-surface-elevated)] border border-[var(--color-border)] relative overflow-hidden">
        <div class="absolute -top-1/2 left-1/2 -translate-x-1/2 w-[400px] h-[400px] rounded-full bg-[var(--color-accent)] opacity-10 blur-[100px]"></div>
        
        <div class="relative">
          <h2 class="text-3xl sm:text-4xl font-bold mb-4">
            Ready to Think Different?
          </h2>
          <p class="text-lg text-[var(--color-paper)] opacity-70 mb-8 max-w-xl mx-auto">
            Join thousands of players making predictions on real-world events.
          </p>
          <CTA href={siteConfig.appUrl} size="lg" external class="animate-pulse-glow">
            {t('nav.launchApp', lang)}
          </CTA>
        </div>
      </div>
    </div>
  </section>
</Base>
